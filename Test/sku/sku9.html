<!DOCTYPE HTML>
<html lang="en-US">

<head>
	<meta charset="UTF-8">
	<title>sku</title>
	<style type="text/css">
		html,
		body {
			height: 100%;
		}

		.sb {
			background-color: rgba(0, 0, 0, 0.5);
			height: 100%;
		}

		.sku {
			width: 100%;
			border: 1px solid #ccc;
			background-color: #fff;
			position: absolute;
			bottom: 0;
		}

		.sku img {
			float: left;
			margin: -58px 20px 0 30px;
			width: 30%;
		}

		.sku b {
			display: inline-block;
			width: 64%;
			line-height: 32px;
		}

		.sku b:first-of-type {
			margin-top: 48px;
			color: #f00
		}

		.sku b:last-of-type {
			display: block;

		}

		.sku a {
			position: relative;
			display: inline-block;
			margin-left: 2em;
			background: #fff;
			line-height: 1.8;
			padding: 0.2em 01em;
			border: 1px solid #ddd;

		}

		.sku a:hover {
			border-color: #f60;
		}

		.sku a.ca {
			border-color: #f60;
		}

		.sku a.dis {
			color: #ddd;
		}

		.sku a.ca:after {
			content: 'v';
			font-size: 0.5em;
			color: transparent;
			line-height: 1em;
			height: 1em;
			position: absolute;
			bottom: 0;
			right: 0;
			font-weight: 300;
			box-sizing: border-box;
			width: 0;
			border-bottom: 1em solid #f60;
			border-left: 1em solid transparent;
			text-shadow: -0.45em 2px 0 #fff;

		}

		.sku a:first-of-type {

			background: #eee;

		}

		.sku a.fs {
			font-weight: 600;
			width: 100%;
			background: transparent;
			color: #333;
			border: none;
			margin-left: 0;
		}

		.bt1 {
			display: block;
		}

		.bt9 {
			background-color: #eee;
		}
	</style>
</head>

<body>
	<div class="sku">
		<img src="https://cdn.17shanyuan.com/goods/284566/8b7dcb0571eb85a6aad0b23d1c283cd94f598fc2.jpeg?x-oss-process=style/webp_240"
		/>
		<b>¥0.05</b>
		<b>库存：1111件</b>
		<b>已选：M kg 袋 Linux 5kg 12瓶 </b>
		<p id='num'>购买数量</p>
		<a class="bt1" id='bt1'>确定</a>
	</div>
	id stock price originPrice 0,1 100 10 15 0,0 999 20 25 1,1 5 30 35
	<script type="text/javascript" src="http://localhost/Js/Base.js"></script>
	<script type="text/javascript">
		//服务返回数据：
		var dirty = {
			"code": 200,
			"message": "获取成功",
			"data": {
				"goods": {
					"goodsId": "a09prAB3",
					"goodsName": "王蕾测试试销",
					"createId": "4293",
					"localIncreaseIncome": "0.00",
					"poorIncreaseIncome": "0.00",
					"isPoorCounty": 1,
					"supportCountyId": "610426000000",
					"poorCount": "13341",
					"supportCountyIsPoorCounty": 1,
					"goodsAreasMap": null,
					"specName": null,
					"createName": null,
					"selfCounty": "610426000000",
					"goodsStatus": 3,
					"sumSaleNum": 0,
					"helpCount": 0,
					"presellRemainAt": null,
					"skuPropertyIdList": ["b19aa02f409e4284bf9e6cb69073e4e0", "4071663292dc4d5c9399034b1b91a6aa"],
					"selfCountyStr": "永寿县",
					"createAt": 1535787473000,
					"originStoreId": "94116",
					"buyLimitCount": 0,
					"buyLimitCity": ["320", "110", "410"],
					"referGoodsUrl": ["http://www.baidu.com", "http://www.baidu.com"],
					"supportCounty": ["永寿县"],
					"goodsMediaList": [{
						"goodsMediaId": "5175221c83754bac8c284568445ee49d",
						"imgUrl": "https://cdn.17shanyuan.com/goods/94116/6f89a00dd23debc2790e7b36d582758c35568daa.jpeg",
						"videoUrl": "",
						"position": 1,
						"idx": 0,
						"type": 1,
						"status": 1
					}],
					"goodsMainMedia": {
						"goodsMediaId": "cc5ae5cf3f134c0ca49f62fead38d843",
						"idx": 0,
						"imgUrl": "https://cdn.17shanyuan.com/goods/94116/d65609cad7e0f5aec561b4e24749517dad0baabf.jpeg",
						"position": 0,
						"status": 1,
						"type": 1,
						"videoUrl": ""
					},
					"storeId": "94116",
					"custStoreId": "94116",
					"mode": 0,
					"sender": "94116",
					"senderType": 0,
					"areaId": "110105000000",
					"speciesId": "1482",
					"transFeeTemplateId": null,
					"transFeeTemplateBO": null,
					"goodsDesc": "[{\"idx\":0,\"max_num\":1,\"type\":\"img\",\"value\":[\"https://cdn.17shanyuan.com/goods/94116/46d87a04f68c1f95a0d7566519b5ddcc1bd3a3f3.jpeg\"]}]",
					"goodsType": 1,
					"presellAt": null,
					"promiseDeliveryAt": null,
					"propertyList": [{
						"propertyId": "e14f78bff06a4ff488b522cc8c174f0d",
						"idx": 6,
						"propertyName": "供货渠道",
						"goodsPropertyId": "0d7e8bb15c374e4ca44f017780e44e2b",
						"propertyValueId": "aed94c2ce70c442ea72ad04e42d14a17",
						"propertyValueName": "自产",
						"type": 2,
						"typeValue": "0"
					}, {
						"propertyId": "6fb2fd41551f4a6a9a045e4bde85c87f",
						"idx": 3,
						"propertyName": "质量承诺",
						"goodsPropertyId": "240ec02ed3b14f78932fffe4e8b4f871",
						"propertyValueId": "553c5ec2db904d4a83c31c59d0ec96b1",
						"propertyValueName": "保证色泽无异样",
						"type": 3,
						"typeValue": "0"
					}, {
						"propertyId": "8b9c0cc3b26140ebb2177fc39db9bb0e",
						"idx": 0,
						"propertyName": "产品和包装照片",
						"goodsPropertyId": "3b9abf24f1f347faae1d9f2ec86812ce",
						"propertyValueId": "",
						"propertyValueName": "https://cdn.17shanyuan.com/goods/94116/3e77b9121c7bfd528eaa3ba409186d99ce9d339f.jpeg",
						"type": 5,
						"typeValue": "0"
					}, {
						"propertyId": "8adcbdbc12914722959c38e2a73e4bde",
						"idx": 1,
						"propertyName": "供货渠道证书",
						"goodsPropertyId": "4cf9b55905f445a2977b869166bce79c",
						"propertyValueId": "",
						"propertyValueName": "https://cdn.17shanyuan.com/goods/94116/9dc1f6c497aa3abd048eca4cccc304dc46eeca59.jpeg",
						"type": 5,
						"typeValue": "0"
					}, {
						"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
						"idx": 9,
						"propertyName": "个数",
						"goodsPropertyId": "5a4cf501d35a4495b03542aae4c052e0",
						"propertyValueId": "51a01f51c57e462fa85fb05c10708f03",
						"propertyValueName": "12瓶",
						"type": 3,
						"typeValue": "0"
					}, {
						"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
						"idx": 8,
						"propertyName": "重量",
						"goodsPropertyId": "65388241c5724a54b091f74052dc94e4",
						"propertyValueId": "fe9985aa272d45e3b841559800247241",
						"propertyValueName": "2.1",
						"type": 3,
						"typeValue": "0"
					}, {
						"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
						"idx": 7,
						"propertyName": "重量",
						"goodsPropertyId": "66a6a88602b34415b1d7e147036e8bb4",
						"propertyValueId": "4806211b34224e25b79cabfd37038737",
						"propertyValueName": "5kg",
						"type": 3,
						"typeValue": "0"
					}, {
						"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
						"idx": 10,
						"propertyName": "个数",
						"goodsPropertyId": "a6bc255b195147a0b07875ecbebc3dc7",
						"propertyValueId": "f875dc88795c49188f8e52743347d85c",
						"propertyValueName": "12个",
						"type": 3,
						"typeValue": "0"
					}, {
						"propertyId": "65b8dccdf545408fb7e9186441295beb",
						"idx": 4,
						"propertyName": "保质期(无用)",
						"goodsPropertyId": "cd5e89ad60a547c7b7cedb4fa4e5f101",
						"propertyValueId": "",
						"propertyValueName": "",
						"type": 6,
						"typeValue": "60"
					}, {
						"propertyId": "722ff3e813394a2bbe3ccf8277b8a2d0",
						"idx": 2,
						"propertyName": "是否现采摘现",
						"goodsPropertyId": "ec79ba77bfb44a94a00e7c1799154a86",
						"propertyValueId": "ce71646c4edc4927bf4be88d9c16960e",
						"propertyValueName": "否",
						"type": 2,
						"typeValue": "0"
					}],
					"skuList": [{
						"skuId": "a09prAB3AC",
						"skuImgUrl": null,
						"originPrice": "15.00",
						"costPrice": null,
						"points": "0",
						"price": "10.00",
						"stocks": 100,
						"wholesaleList": null,
						"skuValueList": [{
							"skuValueId": "ad4e396899c34cec87ae38ca060f48cd",
							"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
							"propertyName": "重量",
							"propertyValueId": "4806211b34224e25b79cabfd37038737",
							"propertyValueName": "5kg",
							"skuValue": null,
							"idx": null
						}, {
							"skuValueId": "0c9165b8752d4509932a18aefae11aab",
							"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
							"propertyName": "个数",
							"propertyValueId": "51a01f51c57e462fa85fb05c10708f03",
							"propertyValueName": "12瓶",
							"skuValue": null,
							"idx": null
						}],
						"isWholesale": 0,
						"skuStatus": 1,
						"saleNum": 0,
						"isDefault": 1,
						"spec": null,
						"isLock": 0,
						"state": 1,
						"topicGoodsNum": null,
						"topicGoodsPrice": null
					}, {
						"skuId": "a09prAB3AD",
						"skuImgUrl": null,
						"originPrice": "25.00",
						"costPrice": null,
						"points": "0",
						"price": "20.00",
						"stocks": 999,
						"wholesaleList": null,
						"skuValueList": [{
							"skuValueId": "65292194bec441858974dfaf7a68495e",
							"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
							"propertyName": "重量",
							"propertyValueId": "4806211b34224e25b79cabfd37038737",
							"propertyValueName": "5kg",
							"skuValue": null,
							"idx": null
						}, {
							"skuValueId": "ba8ab11ee53e419dae1a4fe8e3aa3f12",
							"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
							"propertyName": "个数",
							"propertyValueId": "f875dc88795c49188f8e52743347d85c",
							"propertyValueName": "12个",
							"skuValue": null,
							"idx": null
						}],
						"isWholesale": 0,
						"skuStatus": 1,
						"saleNum": 0,
						"isDefault": 0,
						"spec": null,
						"isLock": 0,
						"state": 1,
						"topicGoodsNum": null,
						"topicGoodsPrice": null
					}, {
						"skuId": "a09prAB3AE",
						"skuImgUrl": null,
						"originPrice": "35.00",
						"costPrice": null,
						"points": "0",
						"price": "30.00",
						"stocks": 5,
						"wholesaleList": null,
						"skuValueList": [{
							"skuValueId": "0601dee02e7f408da4d919ed59a0e1a3",
							"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
							"propertyName": "重量",
							"propertyValueId": "fe9985aa272d45e3b841559800247241",
							"propertyValueName": "2.1",
							"skuValue": null,
							"idx": null
						}, {
							"skuValueId": "0bcfcb22527f4204a692110d3ac43a89",
							"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
							"propertyName": "个数",
							"propertyValueId": "51a01f51c57e462fa85fb05c10708f03",
							"propertyValueName": "12瓶",
							"skuValue": null,
							"idx": null
						}],
						"isWholesale": 0,
						"skuStatus": 1,
						"saleNum": 0,
						"isDefault": 0,
						"spec": null,
						"isLock": 0,
						"state": 1,
						"topicGoodsNum": null,
						"topicGoodsPrice": null
					}],
					"isQuality": 0,
					"approveContent": null,
					"areaMap": {
						"0": {
							"areaId": "1",
							"areaCode": null,
							"areaName": "中国",
							"parentId": "0",
							"hasChild": 0
						},
						"1": {
							"areaId": "110",
							"areaCode": null,
							"areaName": "北京市",
							"parentId": "1",
							"hasChild": 0
						},
						"2": {
							"areaId": "110100000000",
							"areaCode": null,
							"areaName": "市辖区",
							"parentId": "110",
							"hasChild": 0
						},
						"3": {
							"areaId": "110105000000",
							"areaCode": null,
							"areaName": "朝阳区",
							"parentId": "110100000000",
							"hasChild": 0
						}
					},
					"isCanUseCode": false,
					"identificationMap": {},
					"skuValueMap": {
						"b19aa02f409e4284bf9e6cb69073e4e0": [{
							"skuValueId": "65292194bec441858974dfaf7a68495e",
							"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
							"propertyName": "重量",
							"propertyValueId": "4806211b34224e25b79cabfd37038737",
							"propertyValueName": "5kg",
							"skuValue": null,
							"idx": null
						}, {
							"skuValueId": "69fc6451335642bb87922b90c174974d",
							"propertyId": "b19aa02f409e4284bf9e6cb69073e4e0",
							"propertyName": "重量",
							"propertyValueId": "fe9985aa272d45e3b841559800247241",
							"propertyValueName": "2.1",
							"skuValue": null,
							"idx": null
						}],
						"4071663292dc4d5c9399034b1b91a6aa": [{
							"skuValueId": "ba8ab11ee53e419dae1a4fe8e3aa3f12",
							"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
							"propertyName": "个数",
							"propertyValueId": "f875dc88795c49188f8e52743347d85c",
							"propertyValueName": "12个",
							"skuValue": null,
							"idx": null
						}, {
							"skuValueId": "0bcfcb22527f4204a692110d3ac43a89",
							"propertyId": "4071663292dc4d5c9399034b1b91a6aa",
							"propertyName": "个数",
							"propertyValueId": "51a01f51c57e462fa85fb05c10708f03",
							"propertyValueName": "12瓶",
							"skuValue": null,
							"idx": null
						}]
					},
					"totalPrice": "0.00",
					"north4CountyGoods": true
				}
			}
		}
		var goods = dirty.data.goods,
			attr = goods.skuValueMap,
			arr = [],/*属性列表*/
			skus = [],/*有效sku*/
			sed = [];/*已选项的集合*/
		/*过滤服务返回有效sku数据*/
		for (var i = 0; i < goods.skuList.length; i++) {
			var p = goods.skuList[i];

			var pair = [];
			pair.id = p.skuId;//idi;//
			pair.stock = p.stocks;//库存
			pair.price0 = p.originPrice;//原价
			pair.price = p.price;//现价
			for (var j = 0; j < p.skuValueList.length; j++) {
				var a = p.skuValueList[j];
				pair.push(a.propertyValueName);
			}
			skus.push(pair);
		}
		/*过滤服务返回的数据*/
		for (var i = 0; i < goods.skuPropertyIdList.length; i++) {
			var id = goods.skuPropertyIdList[i];
			var ar = [];
			ar.tit = attr[id][0].propertyName;
			for (var j = 0; j < attr[id].length; j++) {
				ar.push(attr[id][j].propertyValueName)
			}
			arr.push(ar);
		}
		;
		console.log('arr：',arr.join(),'\nskus：',skus.join());
		/*将属性列表arr绑至页面
		arr[2] = ["red", "bule"]
		arr[2].tit = "color"*/
		//console.log(arr[1])
		var num = C.G('num');
		//console.log('属性列表：',arr)
		for (var i = 0; i < arr.length; i++) {
			//设置项标题
			var t = C.Ce('a');
			t.innerText = arr[i].tit;
			C.AddClass(t, "fs");
			num.parentNode.insertBefore(t, num)
			for (var j = 0; j < arr[i].length; j++) {
				var a = C.Ce("a");
				a.pi = i;//当前分类项索引
				a.i = j;//当前项索引

				a.innerText = arr[i][j];
				//if(j==0)
				//C.AddClass(a,"fs");
				//else
				C.AddEvent(a, "click", slct, a)
				arr[i][j] = a;
				num.parentNode.insertBefore(a, num)
			}
		}


		/*用户选中sku项处理函数*/
		function slct(a) {
			var pc = arr[a.pi],//父类别
				ci,/*当前分类中选中项索引*/
				ca;/*当前分类中选中项*/
			if (pc.ca) {
				C.DelClass(pc.ca, 'ca');
				sed.splice(a, 1);
			}
			if (pc.ca != a) {
				C.AddClass(a, 'ca');
				ca = a;
				ci = a.i;

				sed.push(a);
			}
			pc.ca = ca;
			pc.ci = ci;
			filt();
			//
		}
		//console.log(arr, skus)

		//console.log(skus[0].pair,skus[1].pair,skus[2].pair,arr)
		//console.log(arr.concat(skus).join())
		//console.log(skus.join())


		
		/*
		传入项是否包括在有效sku列表中
		
		function inSku(it) {
		console.log(it.innerText)
			//console.log(n,v);
			for (var j = 0; j < skus.length; j++) {
				console.log(j,'______')
				var s = skus[j];
				if (it.innerText == s[it.pi])
				//if(v.i==j)
				{
				
					it.style.color='#090';
					//console.log(Math.random(), it.i==j, it, s[i])
					//return it.innerText == s[i];
				}
				else
				{
				it.style.color='#ddd'
				}
			}

		}*/
		/*
		设置默认选中sku
		*/
				/*
		项是否可选
		*/
		
		filt();
		
		function filt(o) {var sk=skus;//匹配选中项后可能的sku组合
		//console.log(o);
			/*arr和skus中子项sku等长,下标可匹配*/
			var z = 0
			console.log('i','n','j','k','____________________')
			for (var i = 0; i < arr.length; i++) {
				var ar = arr[i],
				ed=ar.ci != undefined;//该项有选中项
					//sku = skus[i];
				/*if (ed)//
				{
				console.log(ar[ar.ci].innerText)
					//console.log('i','n','j','k',ar[ar.ci].innerText,'____________________')
					//a++;
					//sk=
				}
				else*/
					for (var n = 0; n < ar.length; n++) {
						var it = ar[n];
						//if(o)console.log(o);
						//it.s=inSku(it);
						//console.log(it.s)
						//it.s=false;
						for (var j = 0; j < sk.length; j++) {
							//console.log(j,'______')
							z++;
							var s = sk[j];
							if(ed)
							{
							var m=s.indexOf(it.innerText);
							console.log('m',m,it.innerText)
							if(m<0)
							{
							//sk.splice(s,1);
							console.log(it.innerText,s)
							}
							}
							//console.log(i, n, j,it.pi,it.innerText,s[it.pi],z)
							//if(it.innerText==s[it.pi])
							if(it.innerText==s[it.pi])
							{
									it.style.color = '#090';
									it.s = true;
							}
							else
							{
							it.style.color = '#ddd';
									it.s = false;
							}
							if(it.s)
							break;
							
							/*
							for (var k =0; k < s.length; k++) {
							//k=k+a;
								z++
								//if (ar.ci != undefined)break;

								console.log(i, n, j, k, it.innerText, s[k], z, s.join())
								//console.log(it.innerText,s[k])
								if (it.innerText == s[i]) {

									it.style.color = '#090';
									it.s = true;
									//j=0;
									break
									//i++;
									//console.log(Math.random(), it.i==j, it, s[i])
									//return v.innerText == s[i];
								}
								else {
									it.style.color = '#ddd';
									//it.s=false;
									//break;

								}
							}
							*/

								
							//if (it.s)
								//break;

						}

					}

			}

			/*
			
				var a = ["a","b","c"];
				var b = ["d","e"];
				var c = ["f"];
				var x = new Array();
				x.push(a);
				x.push(b);
				x.push(c);
				var result = new Array(a.length*b.length*c.length);
			 
				function pl(c,r){
					var p = r.length/c.length;
					for(var i=0;i<c.length;i++){
						var start = i*p;
						for(var j=0;j<p;j++){
							var v = r[start+j];
							if(v){
								r[start+j]=v+"-"+c[i];
							}else{
								r[start+j]=c[i];
							}
							 
						}
					}
				}
				for(var i=0;i<x.length;i++){
					pl(x[i],result);
				}
				console.log(result)
				*/
			/*
			var str = "A,B,C,D,E";
			var arr = str.split(",");
			for (var a2 = []; a2.push([]) < arr.length;);
			var l = Math.pow(2, arr.length)-1;
			for (var i = 1; i <= l; i++) {
				var t = [];
				for (var s=i,k=0; s>0; s>>=1,k++)
					if (s&1==1)
						t.push(arr[k]);
				a2[t.length-1].push(t.join(""));
			}
			console.log(a2.join("\n"));
			*/




			//selected
			/*
			for(var k=0;k<sed.length;k++)
			{
			//console.log(sed[k].innerText)
			}*/
			//raw array
			//console.log(skus[0].pair,skus[1].pair,skus[2].pair,skus)
		}

	</script>
</body>

</html>